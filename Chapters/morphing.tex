% Chapter Template

\chapter{Morphing of Local Statistics: Mapping Ensembles through a Resolution Bottleneck} % Main chapter title

Top-Down coarse-grained models aim at reproducing certain experimentally observed phenomenas or to study the consequences upon application of general rules. As such, top-down coarse-grained models are typically not chemically specific. However, in many cases the coarse-grained model incorporates both philosophies, i.e. bottom-up and top-down aspects. Examples of such hybrid models include the Martini forcefield, where a structure-based method is used to tune bonded interactions, and the KG polymer model with a tuned bending potential, which allows to establish a relation to real polymers at the Kuhn scale. While those models can be considered as chemically-specific, they lack the structural fidelity of solely structure-based coarse-grained models. This issue becomes especially apparent when the ensemble of the coarse-grained model is compared with an ensemble of an higher resolution model of the specific system mapped to the coarse-grained resolution. 

In this chapter, a method to improve the quality of molecular structures obtained with hybrid top-down models is investigated. In particular, the method aims at morphing local statistics in order to resemble a given target distribution more closely. To this end, a local scale is introduced that defines the extent to which features are allowed to change. Specifically, molecular structures of an initial distribution are further coarse-grained up to this scale. Afterwards, DBM is applied to reintroduce local features learned from examples of the target system. 

The motivation for this project is to introduce a two-step backmapping scheme for hybrid top-down coarse-grained models. Backmapping of imperfect molecular structures is expected to yield unphysical artifacts. In order to reduce such artifacts already on the coarse-grained scale, local statistics of the coarse-grained structure are corrected before serving it as an input for the backmapping algorithm. 

In the following, the method is applied to two systems: (1) A condensed-phase system of the alkene tetracosane sampled with the Martini forcefield and (2) a polymer melt of sPS sampled with the KG moldel with additional bending potential. The content presented in this chapter is not published yet.

\label{morphing} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

\begin{figure}
  \centering
      \includegraphics[width=1.0\textwidth]{./Figures/morphing/intro2.png}
  \caption{morphbm}
  \label{FIG:TET_morphbm}
\end{figure}


\section{Method}

The method applied in this chapter aims at morphing local features of molecular structures by passing them through a resolution bottleneck. The idea is inspired by the concept of cross-modal learning (CML) known in the ML community.\cite{feng2014cross, cao2016correlation, mukherjee2017deep, yoo2019image} CML is used to link sources of information from different domains, such as audio-to-image translation. In its core, two autoencoder $A$ and $B$ are trained to encode and decode samples $\mathbf{a}$ and $\mathbf{b}$ from two different distributions $\mathcal{A}$ and $\mathcal{B}$. Cross-connecting the encoder $e$ and decoder $d$ of both models, i.e. $d_B\big(e_A(\mathbf{a})\big)$ and $d_A\big(e_B(\mathbf{b})\big)$ respectively, aims at mapping between the distributions $\mathcal{A}$ and $\mathcal{B}$. However, connecting the latent distribtions of both models, i.e. the information-bottleneck, is challenging and subject to current research.\cite{wang2016comprehensive}

Here, two distributions of molecular structures $\mathcal{X}$ and $\mathcal{Y}$ are given, where the resolution of both distributions is equivalent. While the ultimate goal is to introduce a ML based mapping function $g_{\Theta}$ from one distribution to the other, i.e. $g_{\Theta}(\mathcal{X}) \approx \mathcal{Y}$, it is investigated if such a mapping can be realized by changing features only on a local scale. In other words, it is hypothesized that both distributions match at a lower resolution. To this end, a simple encoder $e_s$, i.e. a fine-to-coarse mapping of the coordinates, is chosen that reduces the number of particles $n$ by a factor $s$

\begin{equation}
 e_{s}: \mathbb{R}^{3n} \rightarrow \mathbb{R}^{3n/s} .
\end{equation}

Specifically, $e_n$ computes the center of mass for groups of $n$ particles. Afterwards, the coarse-grained structure is backmapped utilizing DBM as explained in Sec. \ref{methology}. Importantly, DBM is trained solely on structures drawn from the target distribution $\mathcal{Y}$ but deployed for coarse-grained structures drawn from the input distribution $\mathcal{X}$. As such, local features removed by $e_s$ are reinserted based on the local correlations learned from $\mathcal{Y}$. 

Deploying different values for the coarse-graining factor $s$ allows to scale the extent to which local features are allowed to change. Assuming that the backmapping scheme yields a perfect reconstruction, the mapping $g_{\Theta}(e_s(\mathcal{X}))$ is expected to yield a more accurate reproduction of $\mathcal{Y}$ the larger $s$ becomes, since the reinsertion of details becomes less restricted by the coarse-grained representation. However, larger values of $s$ lead to a more complex backmapping excercise. As such, chosing the value for $s$ is a trade-off between the complexity of the backmapping task and the impact of the morphing. 

The proposed method is solely data driven, i.e it avoids to parametrize a forcefield for the given target distribution. However, the quality of morphed structures can be improved by incorporating an artificial energy landscape that penalizes forbitten configurations in terms of bond lengths, angles and non-bonded distances. In particular, a harmonic potential of the form

\begin{equation}
 U(s) =
  \begin{cases}
      a(s - s_{\text{min}})^2,& s < s_{\text{min}}\\
      a(s - s_{\text{max}})^2,& s > s_{\text{max}}\\
      0,              & \text{otherwise},
  \end{cases}
\end{equation}

is applied as bonded interaction, where $s$ represents bond lengths and angles, respectively, and $a$ is a scaling factor.  Similarly, a harmonic potential for non-bonded distances $d$

\begin{equation}
 U(d) =
  \begin{cases}
      a(1 - \frac{d}{d_{\text{min}}})^2,& d < d_{\text{min}}\\
      0,              & \text{otherwise},
  \end{cases}
\end{equation}

is introduced, where $d_{\text{min}}$ is the minimum distance for non-bonded particles. The values for the minimum and maximum distances/angles are obtained from distributions of the target system.

\section{Kremer-Grest Model: Syndiotactic Polystyrene}

The Kremer-Grest (KG) model is a standart model for computer simulations of polymeric systems. It is designed to study generic polymer properties with an emphasise on computational efficiency and simplicity. As outlined in Sec. \ref{}, the KG model is a bead-spring model, where consecutive beads are connected via strong nonlinear springs, i.e. the FENE potential (Eq. \ref{}), and mutual interactions between all beads are modeled via a truncated Lennard-Jones potential (Eq. \ref{}). The deployed interaction potentials aim at reproducing topological contraints of real polymeric systems, i.e. chain backbones are prohibitted to pass through each other. As such, the KG model is able to yield large scale entanglement properties that are characteristic for long-chain polymers. In order to modify the stiffness of the polymer chains, an additional bending potential can be introduced (Eq. \ref{}) scaled by the prefactor $\kappa$.

An important characteristic of many polymeric systems is their universal large-scale behavior that manifests in scaling relations. Specifally, the mean square end-to-end distance $\langle R^2_e \rangle$ of a polymer chain scales with the number of beads $N$, i.e. $\langle R^2_e \rangle \propto N^{2\nu}$. In a melt state, polymers resemble the charateristics of a random-walk and $\nu = \frac{1}{2}$. However, local interactions of real polymers introduce correlations between monomers that ultimately increase $\langle R^2_e \rangle$. In order to account for such correlations, the results known for ideal chains, i.e. the random-walk behavior $\langle R^2_e \rangle = l^2 N$, requires a correction

\begin{equation}
  \langle R^2_e \rangle = C_{\infty} l^2 N ,
\end{equation}

where $l$ is the bond length between consecutive monomers and $C_{\infty}$ is Flory's charateristic ratio. Note that $C_{\infty}$ depends on the local stiffness of the polymer chain.

The Kuhn length $b$ characterizes the crossover from local, chemistry specific to universal, random-walk behavior. It is defined by mapping the real chain onto an equivalent ideal chain with $n$ segments of length $b$ that reproduces $\langle R^2_e \rangle$ and the contour length $L = N l$, i.e.

\begin{equation}
    \langle R^2_e \rangle =  b^2 n ,
\end{equation}

\begin{equation}
    L = nb .
\end{equation}

The Kugn number $n_k$ is a dimensionless parameter, which defines the number of Kuhn segments within a cube of length $b$,

\begin{equation}
\label{kuhn_number}
  n_k = \rho_k b^3 ,
\end{equation}

where $\rho_k$ is the number density of Kuhn segments. It is observed that $n_k$ systematically correlate with emergend properties such as the entanglement length.\cite{}. As such, the Kuhn number $n_k$ is a key parameter characterizing a specific polymer chemistry and therefore allows to link experimentally observed commodity polymers with model polymers melts, such as the KG model.

While the Kuhn number $n_k$ is material specific and depends on atomic details it is not straight forward to infer its dependence on the deployed interaction potentials. However, Everes et. al have found a direct relation between the chain stiffness $\kappa$ of the KG model and the implied Kuhn number $n_k$,

\begin{equation}
  b(\kappa) = b^{(0)} + \Delta b ,
\end{equation}

\begin{equation}
  \Delta b = 0.77 \sigma (\text{tanh}(-.03\kappa^2 - 0.41 \kappa + 0.16) + 1),
\end{equation}

where $b^{(0)}$ is the bare Kuhn length in the absence of excluded volume interactions and $sigma$ is the bead diameter. Given the Kuhn length $b$ it is straight forward to infer to corresponding Kuhn number $n_k$ from Eq. \ref{kuhn_number}. 

In summary, the KG model with additional bending potential offers a one parameter model that covers a wide range of experimentally relevant commodity polymers. Such Kuhn scale matched model polymers can be regarded as a special case of structure-based coarse-graining. By controlling the Kuhn number with the parameter for the chain stiffness $\kappa$ allows to reproduce emergent universal large length and time scale behavior. However, this remarkable simple model only allows to retain the behavior above the Kuhn scale, whereas particular properties below the Kuhn scale, i.e. local properties, are not expected to resemble the target system. Specifically, solely structure-based coarse-grained models on a similar level of resolution are presumed to yield a locally more faithful representation.

To underpin the above statement, the moderately coarse-grained model for syndiotactic polystyrene by Fritz et. al is considered, which is already deployed in Sec. \ref{}. The model is parametrized based on detailed all-atom simulations of stereoregular PS sequences in vacuum and reproduces the target thermodynamic properties with remarkable accuracy.\cite{} A simulation of the Fritz forcefield is carried out in the NPT ensemble using ... In the following, the model is referred to as \textit{Fritz} model. 

In order to compare the the ensembles obtained with the Fritz model and KG model, the former is mapped onto the resolution of the KG model. Following \cite{}, three polystyrene monomers are mapped onto a single KG bead, which is positioned according to the center of mass of the corresponding monomers. Snapshots of the KG model are obtained by an NVT simulation performed with Espresso++.\cite{} The standard paramteres for the KG model are deployed, i.e. $\sigma =$ and $blabla =$. The chain stiffness is set to $\kappa = 0.8815$ in order to obtain the correct large scale behavior. While \cite{} only lists values for the stiffness corresponding to isotactic and atactic polystyrene, the mean value of both is deployed in this study to model syndiotactic polystyrene. Distances in the KG model are rescaled such that the particle density obtained with the Fritz model is reproduced.

\begin{figure}
  \centering
      \includegraphics[width=0.8\textwidth]{./Figures/morphing/sPS/morph_ff_dists.pdf}
  \caption{morphgibbs}
  \label{FIG:TET_morphgibbs}
\end{figure}

\begin{figure}
  \centering
      \includegraphics[width=1.1\textwidth]{./Figures/morphing/sPS/free_energy_with_snapshots.pdf}
  \caption{SM free energy}
  \label{FIG:TET_morphgibbs}
\end{figure}


\begin{table}
\begin{tabular}{ c|c|c } 
 & scheme A & scheme B \\
\hline
s = 2 & 0.436 & 4.654 \\ 
s = 4 & 1.953 & 0.646 \\ 
s = 6 & 3.589 & 3.495  
\caption{ Jenson-Shannon divergence. KG: 4.661 }
\label{TAB:sPS_chem_trans}
\end{tabular}
\end{table}

\begin{figure}
  \centering
      \includegraphics[width=0.8\textwidth]{./Figures/morphing/sPS/dbm_morphed.pdf}
  \caption{morphgibbs}
  \label{FIG:TET_morphgibbs}
\end{figure}

\section{Martini Model: Tetracosane}

\begin{figure}
  \centering
      \includegraphics[width=0.8\textwidth]{./Figures/morphing/tetracosane/morph_ff_dists.pdf}
  \caption{morphbm}
  \label{FIG:TET_morphbm}
\end{figure}

\begin{figure}
  \centering
      \includegraphics[width=1.1\textwidth]{./Figures/morphing/tetracosane/free_energy_with_snapshots.pdf}
  \caption{SM free energy}
  \label{FIG:TET_morphgibbs}
\end{figure}

\begin{table}
\begin{tabular}{ c|c|c } 
 & scheme A & scheme B \\
\hline
s = 2 & 2.338 & 1.213 \\ 
s = 3 & 2.925 &  1.197 
\caption{ Jenson-Shannon divergence. martini: 2.239 }
\label{TAB:sPS_chem_trans}
\end{tabular}
\end{table}

\begin{figure}
  \centering
      \includegraphics[width=0.8\textwidth]{./Figures/morphing/tetracosane/dbm_morphed.pdf}
  \caption{morphbm}
  \label{FIG:TET_morphbm}
\end{figure}


\section{Discussion}
